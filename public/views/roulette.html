<?php
require_once __DIR__ . '/../../src/Services/RouletteGameService.php';

$rouletteNumbers = RouletteGameService::getRouletteNumbers();
$redNumbers = RouletteGameService::getRedNumbers();
$chipValues = [1, 2, 5, 10, 25, 50, 100, 500, 1000];

$extraStyles = [
    "/public/styles/roulette.css",
];

$extraScripts = [
    "/public/scripts/roulette.js",
];

include __DIR__ . '/../includes/header.html'; ?>

<div class="content-area roulette-page">
    <div class="roulette-app" data-initial-balance="<?php echo htmlspecialchars((string) (isset($_SESSION['user_balance']) ? (int) $_SESSION['user_balance'] : 0), ENT_QUOTES, 'UTF-8'); ?>">
        <div class="roulette-container">
            <div class="horizontal-wheel-container">
                <div class="wheel-pointer"></div>
                <div class="horizontal-wheel-track">
                    <div class="horizontal-wheel" id="rouletteWheel"
                        data-roulette='<?php echo htmlspecialchars(json_encode($rouletteNumbers), ENT_QUOTES, "UTF-8"); ?>'
                        data-red='<?php echo htmlspecialchars(json_encode($redNumbers), ENT_QUOTES, "UTF-8"); ?>'
                        data-repetitions="5">
                        <?php for ($r = 0; $r < 5; $r++): ?>
                            <?php foreach ($rouletteNumbers as $item): ?>
                                <div class="wheel-number <?php echo htmlspecialchars((string) $item['color'], ENT_QUOTES, 'UTF-8'); ?>"><?php echo htmlspecialchars((string) $item['num'], ENT_QUOTES, 'UTF-8'); ?></div>
                            <?php endforeach; ?>
                        <?php endfor; ?>
                    </div>
                </div>
            </div>

            <div class="recent-numbers" id="recentNumbers"></div>
            <div class="betting-controls">
                <div class="bet-input-row">
                    <input
                        type="number"
                        class="bet-input"
                        id="currentBetInput"
                        placeholder="Bet amount..."
                        value=""
                        readonly
                    />
                    <button class="clear-btn" id="clearBetsBtn" disabled>Clear</button>
                </div>

                <div class="chip-buttons">
                    <?php foreach ($chipValues as $chip): ?>
                        <button class="chip-btn" data-chip="<?php echo htmlspecialchars((string) $chip, ENT_QUOTES, 'UTF-8'); ?>">+<?php echo htmlspecialchars((string) $chip, ENT_QUOTES, 'UTF-8'); ?></button>
                    <?php endforeach; ?>

                </div>
            </div>

            <div class="range-bets">
                <div class="range-box red" data-bet="red" data-multiplier="x2">
                    <div class="range-label">RED</div>
                    <div class="range-total">x2</div>
                    <div class="bet-chip"></div>
                </div>

                <div class="range-box green" data-bet="0" data-multiplier="x36">
                    <div class="range-label">0</div>
                    <div class="range-total">x36</div>
                    <div class="bet-chip"></div>
                </div>

                <div class="range-box black" data-bet="black" data-multiplier="x2">
                    <div class="range-label">BLACK</div>
                    <div class="range-total">x2</div>
                    <div class="bet-chip"></div>
                </div>
            </div>

            <div class="betting-table">
                <div class="bet-cell zero" data-bet="0">
                    <span>0</span>
                    <div class="chip"></div>
                </div>
                <div class="number-grid" id="numberGrid">
                    <?php for ($col = 0; $col < 12; $col++): ?>
                        <div class="grid-column">
                            <?php foreach ([3, 2, 1] as $row):
                                $num = $col * 3 + $row;
                                $isRed = in_array($num, $redNumbers, true);
                            ?>
                                <div class="bet-cell number <?php echo htmlspecialchars((string) ($isRed ? 'red' : 'black'), ENT_QUOTES, 'UTF-8'); ?>" data-bet="<?php echo htmlspecialchars((string) $num, ENT_QUOTES, 'UTF-8'); ?>">
                                    <span><?php echo htmlspecialchars((string) $num, ENT_QUOTES, 'UTF-8'); ?></span>
                                    <div class="chip"></div>
                                </div>
                            <?php endforeach; ?>
                        </div>
                    <?php endfor; ?>
                </div>
            </div>

            <div class="roulette-status">
                <div class="status-label">Winning number:</div>
                <div class="status-value" id="winningNumber">-</div>
            </div>

            <div class="roulette-status">
                <div class="status-label">Wygrano:</div>
                <div class="status-value" id="winningsDisplay">+$0</div>
            </div>

            <button class="spin-btn" id="spinBtn" disabled>Spin</button>
        </div>
    </div>
</div>

<?php include __DIR__ . '/../includes/footer.html'; ?>
